<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Rocket X</title>
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        body {
            background-color: #0d0d0d;
            color: #e6e6e6;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        #balance {
            font-size: 1.5em;
            margin-bottom: 20px;
        }
        #graph-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 400px;
            background-color: #1a1a1a;
            border: 2px solid #555;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        #graph-canvas {
            width: 100%;
            height: 100%;
        }
        #coefficient-display {
            font-size: 2em;
            margin-bottom: 20px;
        }
        #bet-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        #bet-container input {
            width: 150px;
            padding: 10px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
        }
        #bet-container button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            background-color: #ff6600;
            color: #fff;
            border: none;
            border-radius: 5px;
            transition: background 0.3s;
        }
        #bet-container button:hover {
            background-color: #e65c00;
        }
        #cashout-button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            background-color: #00cc66;
            color: #fff;
            border: none;
            border-radius: 5px;
            transition: background 0.3s;
            display: none;
            margin-bottom: 20px;
        }
        #cashout-button:hover {
            background-color: #00994d;
        }
        #message {
            font-size: 1.2em;
            margin-top: 20px;
            text-align: center;
            max-width: 600px;
        }
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            #graph-container {
                height: 300px;
            }
            #bet-container {
                flex-direction: column;
            }
            #bet-container input {
                margin-bottom: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>

<div class="game-container">
    <div id="balance">–ë–∞–ª–∞–Ω—Å: <span id="balance-amount">0</span> üí∞</div>
    <div id="graph-container">
        <canvas id="graph-canvas" width="600" height="400"></canvas>
    </div>
    <div id="coefficient-display">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: x1</div>
    <div id="bet-container">
        <input type="number" id="bet-amount" placeholder="–°—Ç–∞–≤–∫–∞" min="1" value="100">
        <button id="start-button">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
    </div>
    <button id="cashout-button">–í—ã–≤–µ—Å—Ç–∏</button>
    <div id="message"></div>
</div>

<script>
    let gameStarted = false;
    let coefficient = 1;
    let crashPoint;
    let gameInterval;
    let betAmount = 0;
    let cashout = false;

    const balanceAmount = document.getElementById('balance-amount');
    const coefficientDisplay = document.getElementById('coefficient-display');
    const graphCanvas = document.getElementById('graph-canvas');
    const ctx = graphCanvas.getContext('2d');
    const startButton = document.getElementById('start-button');
    const cashoutButton = document.getElementById('cashout-button');
    const message = document.getElementById('message');

    let time = 0;
    let dataPoints = [];

    let balance = 0; // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞
    window.parent.postMessage({ type: 'requestBalance' }, '*');

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
    window.addEventListener('message', function(event) {
        if (event.data.type === 'currentBalance') {
            balance = parseInt(event.data.balance, 10);
            updateBalanceDisplay();
        }
        if (event.data.type === 'updateBalance') {
            balance = parseInt(event.data.balance, 10);
            updateBalanceDisplay();
        }
    });

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –æ–∫–Ω—É
    function updateBalanceDisplay() {
        balanceAmount.textContent = balance;
        window.parent.postMessage({ type: 'updateBalance', balance: balance }, '*');
    }

    function startGame() {
        if (gameStarted) {
            message.textContent = '–ò–≥—Ä–∞ —É–∂–µ –∑–∞–ø—É—â–µ–Ω–∞!';
            return;
        }

        betAmount = parseInt(document.getElementById('bet-amount').value, 10);
        if (isNaN(betAmount) || betAmount <= 0) {
            message.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç–∞–≤–∫—É.';
            return;
        }
        if (betAmount > balance) {
            message.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏.';
            return;
        }
        balance -= betAmount;
        updateBalanceDisplay();
        message.textContent = '';
        coefficient = 1;
        cashout = false;
        gameStarted = true;
        crashPoint = getRandomCrashPoint();
        console.log('Crash point:', crashPoint);
        startButton.disabled = true;
        cashoutButton.style.display = 'inline-block';
        time = 0;
        dataPoints = [];
        ctx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
        coefficientDisplay.textContent = '–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: x1';

        gameInterval = setInterval(() => {
            time += 0.05; // –£–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
            coefficient = calculateCoefficient(time);
            coefficientDisplay.textContent = '–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: x' + coefficient.toFixed(2);

            dataPoints.push({ x: time, y: coefficient });
            drawGraph();

            if (coefficient >= crashPoint) {
                endGame(false);
            }
        }, 50); // –£–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
    }

    function getRandomCrashPoint() {
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–π —Ç–æ—á–∫–∏ –∫—Ä–∞—à–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        let rand = Math.random();
        let crash = Math.max(1.1, -1 / Math.log(rand));
        return crash;
    }

    function calculateCoefficient(t) {
        // –ú–æ–¥–µ–ª—å —Ä–æ—Å—Ç–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞
        return Math.exp(0.15 * t);
    }

    function cashOut() {
        if (gameStarted && !cashout) {
            cashout = true;
            let winnings = betAmount * coefficient;
            balance += winnings;
            updateBalanceDisplay();
            message.textContent = '–í—ã –≤—ã–≤–µ–ª–∏ ' + winnings + ' üí∞ –ø—Ä–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–µ x' + coefficient.toFixed(2);
            endGame(true);
        }
    }

    function endGame(success) {
        clearInterval(gameInterval);
        gameStarted = false;
        startButton.disabled = false;
        cashoutButton.style.display = 'none';
        if (!success && !cashout) {
            message.textContent = '–†–∞–∫–µ—Ç–∞ –≤–∑–æ—Ä–≤–∞–ª–∞—Å—å –ø—Ä–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–µ x' + coefficient.toFixed(2) + '! –í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ —Å—Ç–∞–≤–∫—É.';
        }
    }

    function drawGraph() {
        ctx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);

        ctx.beginPath();
        ctx.moveTo(0, graphCanvas.height);
        for (let i = 0; i < dataPoints.length; i++) {
            let x = (dataPoints[i].x / (crashPoint * 1.2)) * graphCanvas.width;
            let y = graphCanvas.height - (dataPoints[i].y / (crashPoint * 1.2)) * graphCanvas.height;
            ctx.lineTo(x, y);
        }
        ctx.strokeStyle = '#ff6600';
        ctx.lineWidth = 2;
        ctx.stroke();
    }

    startButton.addEventListener('click', startGame);
    cashoutButton.addEventListener('click', cashOut);

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
    window.addEventListener('message', function(event) {
        if (event.data.type === 'updateBalance') {
            balance = parseInt(event.data.balance, 10);
            updateBalanceDisplay();
        }
    });
</script>

</body>
</html>
